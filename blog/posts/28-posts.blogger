
<pre><br/>import gobject<br/>import thread<br/><br/>class Function( object ):<br/>   '''a class that represent a function that will run<br/>   on a thread and call a callback with the return value'''<br/><br/>   def __init__( self, function, callback ):<br/>       self.function = function<br/>       self.callback = callback<br/>       self.queue = Queue.Queue( 0 )<br/><br/>   def __call__( self, *args ):<br/>       '''when the object is called we start a thread<br/>       with the function and parameters and start the<br/>       check function that check every 0.2 seconds if<br/>       the thread has ended (there is something in the<br/>       queue), then call the callback with the result'''<br/><br/>       thread.start_new_thread( self._function, args )<br/>       gobject.timeout_add( 200 , self.check )<br/><br/>   def _function( self, *args ):<br/>       '''our function call the parameter function<br/>       with the args and put the return value in the<br/>       queue'''<br/><br/>       self.queue.put( self.function( *args ) )<br/><br/>   def check( self ):<br/>       '''check there is something in the queue<br/>       that means that self.function has ended<br/>       then call the callback with the result'''<br/><br/>       try:<br/>           result = self.queue.get( True, 0.01 )<br/>           self.callback( result )<br/>           return False<br/>       except Queue.Empty:<br/>           return True<br/><br/>if __name__ == '__main__':<br/>   import time<br/><br/>   def funcion(a,b):<br/>       time.sleep(5)<br/>       return a+b<br/><br/>   def callback( suma ):<br/>       print suma<br/><br/>   f = Function( funcion, callback )<br/>   f( 2,3 )<br/>   import gtk<br/>   gtk.main()<br/></pre><br/><br/>una clase que escribi que basicamente permite hacer que una clase se comporte como una funcion, con el adicional de que corre la funcion en un thread aparte y al terminar llama a la funcion callback  pasandole el return como parametro.<br/><br/>util para funciones que demoran mucho para evitar bloquear otras cosas (como el refresco de la interfaz grafica)<br/><br/>si no contamos los comentarios esa clase debe tener 15 lineas, pero el resultado es que nos olvidamos de los threads :)
<div style="clear: both;"/>
