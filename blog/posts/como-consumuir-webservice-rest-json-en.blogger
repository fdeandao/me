
este post es continuación de este: <a href="http://marianoguerra.blogspot.com/2009/03/serializardesserializar-objetos-java.html">http://marianoguerra.blogspot.com/2009/03/serializardesserializar-objetos-java.html</a><br/><br/>ahora vamos a hacer un modulo en javascript para usar la API REST JSON desde una pagina web (lo que normalmente se llama Web 2.0 o AJAX solo que la X de XML la cambiamos por la J de JSON asi que queda AJAJ).<br/><br/>el primer problema que debemos superar es la regla de "<a href="https://developer.mozilla.org/En/Same_origin_policy_for_JavaScript">same origin</a>" de javascript por la cual solo podemos hacer requests asincronicos con HttpRequest solo a la misma URL de la cual se descargo el script, y como nuestra aplicación se va a distribuir en un jar, nuestro js y html tiene que estar en ese jar y lo tiene que servir la misma aplicación, lo que significa que si le pido 0.0.0.0:9999/pagina.html la aplicación tiene que buscar en el jar el archivo en algun lugar y devolverlo. Si el archivo viene de otro lado nuestro request va a fallar.<br/><br/>Para solucionar esto la unica forma que encontre fue escribir un handler a mano para devolver archivos estaticos.<br/><br/><div class="highlight"><pre><span class="c">/*</span><br/><span class="c"> * To change this template, choose Tools | Templates</span><br/><span class="c"> * and open the template in the editor.</span><br/><span class="c"> */</span><br/><br/><span class="k">package</span> <span class="n">addressbook</span><span class="o">;</span><br/><br/><span class="k">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span><br/><span class="k">import</span> <span class="nn">java.net.MalformedURLException</span><span class="o">;</span><br/><span class="k">import</span> <span class="nn">org.mortbay.jetty.handler.ResourceHandler</span><span class="o">;</span><br/><span class="k">import</span> <span class="nn">org.mortbay.resource.Resource</span><span class="o">;</span><br/><br/><span class="c">/**</span><br/><span class="c"> *</span><br/><span class="c"> * @author mariano</span><br/><span class="c"> */</span><br/><span class="k">public</span> <span class="k">class</span> <span class="nc">ContentHandler</span> <span class="k">extends</span> <span class="n">ResourceHandler</span><span class="o">{</span><br/><span class="nd">@Override</span><br/><span class="k">public</span> <span class="n">Resource</span> <span class="nf">getResource</span><span class="o">(</span><span class="n">String</span> <span class="n">path</span><span class="o">)</span> <span class="k">throws</span> <span class="n">MalformedURLException</span><br/><span class="o">{</span><br/><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">path</span><span class="o">);</span><br/><span class="k">try</span><br/><span class="o">{</span><br/><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">getResourceBase</span><span class="o">().</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">"file:"</span><span class="o">,</span> <span class="s">""</span><span class="o">)</span> <span class="o">+</span> <span class="n">path</span><span class="o">);</span><br/><span class="k">return</span> <span class="n">Resource</span><span class="o">.</span><span class="na">newResource</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getResource</span><span class="o">(</span><span class="n">getResourceBase</span><span class="o">().</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">"file:"</span><span class="o">,</span> <span class="s">""</span><span class="o">)</span> <span class="o">+</span> <span class="n">path</span><span class="o">));</span><br/><span class="o">}</span><br/><span class="k">catch</span><span class="o">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="o">)</span><br/><span class="o">{</span><br/><span class="k">return</span> <span class="kc">null</span><span class="o">;</span><br/><span class="o">}</span><br/><span class="o">}</span><br/><span class="o">}</span><br/></pre></div><br/><br/>el archivo Main.java se modifica para agregar este handler a la lista de handlers, quedaria asi:<br/><br/><div class="highlight"><pre><span class="c">/*</span><br/><span class="c"> * To change this template, choose Tools | Templates</span><br/><span class="c"> * and open the template in the editor.</span><br/><span class="c"> */</span><br/><br/><span class="k">package</span> <span class="n">addressbook</span><span class="o">;</span><br/><br/><span class="k">import</span> <span class="nn">com.sun.jersey.spi.container.servlet.ServletContainer</span><span class="o">;</span><br/><span class="k">import</span> <span class="nn">org.mortbay.jetty.Handler</span><span class="o">;</span><br/><span class="k">import</span> <span class="nn">org.mortbay.jetty.handler.DefaultHandler</span><span class="o">;</span><br/><span class="k">import</span> <span class="nn">org.mortbay.jetty.handler.HandlerList</span><span class="o">;</span><br/><span class="k">import</span> <span class="nn">org.mortbay.jetty.servlet.Context</span><span class="o">;</span><br/><span class="k">import</span> <span class="nn">org.mortbay.jetty.servlet.ServletHolder</span><span class="o">;</span><br/><br/><span class="c">/**</span><br/><span class="c"> *</span><br/><span class="c"> * @author mariano</span><br/><span class="c"> */</span><br/><span class="k">public</span> <span class="k">class</span> <span class="nc">Main</span> <span class="o">{</span><br/><br/><span class="c">/**</span><br/><span class="c">     * @param args the command line arguments</span><br/><span class="c">     */</span><br/><span class="k">public</span> <span class="k">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="k">throws</span> <span class="n">Exception</span><span class="o">{</span><br/><span class="n">org</span><span class="o">.</span><span class="na">mortbay</span><span class="o">.</span><span class="na">jetty</span><span class="o">.</span><span class="na">Server</span> <span class="n">server</span><span class="o">;</span><br/><span class="n">ServletHolder</span> <span class="n">holder</span><span class="o">;</span><br/><span class="n">Context</span> <span class="n">contextWS</span><span class="o">;</span><br/><br/><span class="n">holder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServletHolder</span><span class="o">(</span><span class="n">ServletContainer</span><span class="o">.</span><span class="na">class</span><span class="o">);</span><br/><br/><span class="n">holder</span><span class="o">.</span><span class="na">setInitParameter</span><span class="o">(</span><span class="s">"com.sun.jersey.config.property.packages"</span><span class="o">,</span><br/><span class="s">"addressbook.ws"</span><span class="o">);</span><br/><br/><span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="n">org</span><span class="o">.</span><span class="na">mortbay</span><span class="o">.</span><span class="na">jetty</span><span class="o">.</span><span class="na">Server</span><span class="o">(</span><span class="mi">9999</span><span class="o">);</span><br/><br/><span class="n">contextWS</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Context</span><span class="o">(</span><span class="n">server</span><span class="o">,</span> <span class="s">"/ws"</span><span class="o">,</span> <span class="n">Context</span><span class="o">.</span><span class="na">SESSIONS</span><span class="o">);</span><br/><span class="n">contextWS</span><span class="o">.</span><span class="na">addServlet</span><span class="o">(</span><span class="n">holder</span><span class="o">,</span> <span class="s">"/*"</span><span class="o">);</span><br/><span class="n">ContentHandler</span> <span class="n">resource_handler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ContentHandler</span><span class="o">();</span><br/><span class="n">resource_handler</span><span class="o">.</span><span class="na">setResourceBase</span><span class="o">(</span><span class="s">"/resources"</span><span class="o">);</span><br/><span class="n">HandlerList</span> <span class="n">handlers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HandlerList</span><span class="o">();</span><br/><span class="n">handlers</span><span class="o">.</span><span class="na">setHandlers</span><span class="o">(</span><span class="k">new</span> <span class="n">Handler</span><span class="o">[]</span> <span class="o">{</span> <span class="n">resource_handler</span><span class="o">,</span> <span class="n">contextWS</span><span class="o">,</span> <span class="k">new</span> <span class="n">DefaultHandler</span><span class="o">()});</span><br/><span class="n">server</span><span class="o">.</span><span class="na">setHandler</span><span class="o">(</span><span class="n">handlers</span><span class="o">);</span><br/><span class="n">addressbook</span><span class="o">.</span><span class="na">ws</span><span class="o">.</span><span class="na">AddressBook</span><span class="o">.</span><span class="na">fill</span><span class="o">();</span><br/><span class="n">server</span><span class="o">.</span><span class="na">start</span><span class="o">();</span><br/><span class="o">}</span><br/><br/><span class="o">}</span><br/></pre></div><br/><br/>ahora creamos un paquete llamado resources en la base del proyecto en donde vamos a poner nuestros archivos estaticos.<br/><br/>para poder hacer nuestra pagina über AJAX vamos a necesitar dos librerias, jquery y JSON.js, la primera nos ayuda en muchas cosas, siendo una de ellas la de hacer request HTTP que funcione en todos los browsers, la segunda nos sirve para serializar/deserializar objetos javascript.<br/><br/>las urls son las siguientes:<br/><br/><a href="http://jquery.com/">http://jquery.com/</a><br/><br/><a href="http://www.json.org/json2.js">http://www.json.org/json2.js</a><br/><br/><br/>ponemos la libreria jquery-version.js y json2.js que descargamos en el paquete resources.js, creamos un archivo addressbook.js en el mismo paquete.<br/><br/>tambien creamos un archivo addressbook.html en el paquete resources, osea que la estructura quedaria asi:<br/><br/><br/>/resources<br/>/resources/addressbook.html<br/>/resources/js<br/>/resources/js/addressbook.js<br/>/resources/js/jquery-1.3.1.min.js<br/>/resources/js/json2.js<br/><br/>en addressbook.js vamos a crear los metodos de javascript que nos permitan interactuar con el servidor, asi como las clases que debemos enviar serializadas.<br/><br/>ahora pongo el contenido de los archivos.<br/><br/>resources/addressbook.html<br/><br/><br/><div class="highlight"><pre><span class="nt">&lt;html&gt;</span><br/><span class="nt">&lt;head&gt;</span><br/><span class="nt">&lt;title&gt;</span>Address Book<span class="nt">&lt;/title&gt;</span><br/><span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">type=</span><span class="s">"text/css"</span> <span class="na">href=</span><span class="s">"css/style.css"</span> <span class="nt">/&gt;</span><br/><br/><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"js/jquery-1.3.1.min.js"</span> <span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;&lt;/script&gt;</span><br/><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"js/json2.js"</span> <span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;&lt;/script&gt;</span><br/><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"js/addressbook.js"</span> <span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;&lt;/script&gt;</span><br/><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span><br/><br/><span class="k">function</span> <span class="nx">isArray</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span><br/><span class="p">{</span><br/><span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">obj</span> <span class="o">==</span> <span class="s1">'object'</span><span class="p">)</span><br/><span class="p">{</span><br/><span class="k">var</span> <span class="nx">criterion</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">match</span><span class="p">(</span><span class="sr">/array/i</span><span class="p">);</span><br/><span class="k">return</span> <span class="p">(</span><span class="nx">criterion</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">);</span><br/><span class="p">}</span><br/><br/><span class="k">return</span> <span class="kc">false</span><span class="o">;</span><br/><span class="p">}</span><br/><br/><span class="k">function</span> <span class="nx">search</span><span class="p">()</span><br/><span class="p">{</span><br/><span class="k">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'#search'</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span><br/><span class="nx">AddressBook</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="s2">"all"</span><span class="o">,</span> <span class="nx">query</span><span class="o">,</span> <span class="nx">onSearchSucceed</span><span class="o">,</span> <span class="nx">onSearchFailed</span><span class="p">);</span><br/><span class="p">}</span><br/><br/><span class="k">function</span> <span class="nx">onSearchSucceed</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span><br/><span class="p">{</span><br/><span class="nx">showResults</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span><br/><span class="p">}</span><br/><br/><span class="k">function</span> <span class="nx">showResults</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span><br/><span class="p">{</span><br/><span class="k">var</span> <span class="nx">results</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'.results'</span><span class="p">);</span><br/><span class="nx">results</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="s2">""</span><span class="p">);</span><br/><span class="nx">entries</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span><br/><br/><span class="k">if</span><span class="p">(</span><span class="nx">entries</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span><br/><span class="p">{</span><br/><span class="k">return</span><span class="o">;</span><br/><span class="p">}</span><br/><br/><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">entries</span><span class="p">[</span><span class="s2">"entry"</span><span class="p">]))</span><br/><span class="p">{</span><br/><span class="k">var</span> <span class="nx">item</span> <span class="o">=</span> <span class="nx">entries</span><span class="p">[</span><span class="s2">"entry"</span><span class="p">];</span><br/><span class="nx">results</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">firstName</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span> <span class="nx">item</span><span class="p">.</span><span class="nx">lastName</span> <span class="o">+</span> <span class="s1">'&lt;br/&gt;'</span><span class="p">);</span><br/><span class="k">return</span><span class="o">;</span><br/><span class="p">}</span><br/><br/><span class="k">for</span><span class="p">(</span><span class="k">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">entries</span><span class="p">[</span><span class="s2">"entry"</span><span class="p">])</span><br/><span class="p">{</span><br/><span class="k">var</span> <span class="nx">item</span> <span class="o">=</span> <span class="nx">entries</span><span class="p">[</span><span class="s2">"entry"</span><span class="p">][</span><span class="nx">i</span><span class="p">];</span><br/><span class="nx">results</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">firstName</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span> <span class="nx">item</span><span class="p">.</span><span class="nx">lastName</span> <span class="o">+</span> <span class="s1">'&lt;br/&gt;'</span><span class="p">);</span><br/><span class="p">}</span><br/><span class="p">}</span><br/><br/><span class="k">function</span> <span class="nx">onSearchFailed</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span><br/><span class="p">{</span><br/><span class="nx">alert</span><span class="p">(</span><span class="s2">"La busqueda fallo"</span><span class="p">);</span><br/><span class="p">}</span><br/><br/><span class="k">function</span> <span class="nx">getAll</span><span class="p">()</span><br/><span class="p">{</span><br/><span class="nx">AddressBook</span><span class="p">.</span><span class="nx">getAll</span><span class="p">(</span><span class="nx">onGetAllSucceeded</span><span class="o">,</span> <span class="nx">onGetAllFailed</span><span class="p">);</span><br/><span class="p">}</span><br/><br/><span class="k">function</span> <span class="nx">onGetAllSucceeded</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span><br/><span class="p">{</span><br/><span class="nx">showResults</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span><br/><span class="p">}</span><br/><br/><span class="k">function</span> <span class="nx">onGetAllFailed</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span><br/><span class="p">{</span><br/><span class="nx">alert</span><span class="p">(</span><span class="s2">"La busqueda fallo"</span><span class="p">);</span><br/><span class="p">}</span><br/><br/><span class="k">function</span> <span class="nx">create</span><span class="p">()</span><br/><span class="p">{</span><br/><span class="k">var</span> <span class="nx">firstName</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'#firstName'</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span><br/><span class="k">var</span> <span class="nx">lastName</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'#lastName'</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span><br/><span class="k">var</span> <span class="nx">address</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'#address'</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span><br/><span class="k">var</span> <span class="nx">workPhone</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'#workPhone'</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span><br/><span class="k">var</span> <span class="nx">homePhone</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'#homePhone'</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span><br/><span class="k">var</span> <span class="nx">cellPhone</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'#cellPhone'</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span><br/><br/><span class="k">var</span> <span class="nx">entry</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AddressBook</span><span class="p">.</span><span class="nx">AddressBookEntry</span><span class="p">(</span><span class="nx">firstName</span><span class="o">,</span> <span class="nx">lastName</span><span class="o">,</span> <span class="nx">address</span><span class="o">,</span> <span class="nx">homePhone</span><span class="o">,</span> <span class="nx">workPhone</span><span class="o">,</span> <span class="nx">cellPhone</span><span class="p">);</span><br/><span class="nx">AddressBook</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">entry</span><span class="o">,</span> <span class="nx">onCreateSucceeded</span><span class="o">,</span> <span class="nx">onCreateFailed</span><span class="p">);</span><br/><span class="p">}</span><br/><br/><span class="k">function</span> <span class="nx">onCreateSucceeded</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span><br/><span class="p">{</span><br/><span class="nx">alert</span><span class="p">(</span><span class="s2">"entrada añadida con exito"</span><span class="p">);</span><br/><span class="p">}</span><br/><br/><span class="k">function</span> <span class="nx">onCreateFailed</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span><br/><span class="p">{</span><br/><span class="nx">alert</span><span class="p">(</span><span class="s2">"error añadiendo entrada"</span><span class="p">);</span><br/><span class="p">}</span><br/><span class="nt">&lt;/script&gt;</span><br/><span class="nt">&lt;/head&gt;</span><br/><br/><span class="nt">&lt;body&gt;</span><br/><span class="nt">&lt;h1&gt;</span>Address Book<span class="nt">&lt;/h1&gt;</span><br/><br/><span class="nt">&lt;table&gt;</span><br/><span class="nt">&lt;tr&gt;&lt;td&gt;</span>Nombre<span class="nt">&lt;/td&gt;&lt;td&gt;&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">id=</span><span class="s">"firstName"</span><span class="nt">&gt;&lt;/td&gt;&lt;/tr&gt;</span><br/><span class="nt">&lt;tr&gt;&lt;td&gt;</span>Apellido<span class="nt">&lt;/td&gt;&lt;td&gt;&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">id=</span><span class="s">"lastName"</span><span class="nt">&gt;&lt;/td&gt;&lt;/tr&gt;</span><br/><span class="nt">&lt;tr&gt;&lt;td&gt;</span>direccion<span class="nt">&lt;/td&gt;&lt;td&gt;&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">id=</span><span class="s">"address"</span><span class="nt">&gt;&lt;/td&gt;&lt;/tr&gt;</span><br/><span class="nt">&lt;tr&gt;&lt;td&gt;</span>Telefono Trabajo<span class="nt">&lt;/td&gt;&lt;td&gt;&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">id=</span><span class="s">"workPhone"</span><span class="nt">&gt;&lt;/td&gt;&lt;/tr&gt;</span><br/><span class="nt">&lt;tr&gt;&lt;td&gt;</span>Telefono Casa<span class="nt">&lt;/td&gt;&lt;td&gt;&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">id=</span><span class="s">"homePhone"</span><span class="nt">&gt;&lt;/td&gt;&lt;/tr&gt;</span><br/><span class="nt">&lt;tr&gt;&lt;td&gt;</span>Telefono Celular<span class="nt">&lt;/td&gt;&lt;td&gt;&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">id=</span><span class="s">"cellPhone"</span><span class="nt">&gt;&lt;/td&gt;&lt;/tr&gt;</span><br/><span class="nt">&lt;tr&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;input</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">value=</span><span class="s">"Crear"</span> <span class="na">onclick=</span><span class="s">"create();"</span><span class="nt">&gt;&lt;/td&gt;&lt;/tr&gt;</span><br/><span class="nt">&lt;/table&gt;</span><br/><br/><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">id=</span><span class="s">"search"</span> <span class="nt">/&gt;</span><br/><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">value=</span><span class="s">"Search"</span> <span class="na">onclick=</span><span class="s">"search();"</span> <span class="nt">/&gt;</span><br/><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">value=</span><span class="s">"Get All"</span> <span class="na">onclick=</span><span class="s">"getAll();"</span> <span class="nt">/&gt;</span><br/><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"results"</span><span class="nt">&gt;</span><br/><span class="nt">&lt;/div&gt;</span><br/><span class="nt">&lt;/body&gt;</span><br/><span class="nt">&lt;/html&gt;</span><br/></pre></div><br/><br/>resources/js/addressbook.js<br/><br/><div class="highlight"><pre><span class="c">// AddressBook namespace</span><br/><span class="k">var</span> <span class="nx">AddressBook</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Object</span><span class="p">();</span><br/><br/><span class="nx">AddressBook</span><span class="p">.</span><span class="nx">AddressBookEntry</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="nx">firstName</span><span class="o">,</span> <span class="nx">lastName</span><span class="o">,</span> <span class="nx">address</span><span class="o">,</span> <span class="nx">homePhone</span><span class="o">,</span> <span class="nx">workPhone</span><span class="o">,</span> <span class="nx">cellPhone</span><span class="p">)</span> <span class="p">{</span><br/><span class="k">this</span><span class="p">.</span><span class="nx">firstName</span> <span class="o">=</span> <span class="nx">firstName</span><span class="o">;</span><br/><span class="k">this</span><span class="p">.</span><span class="nx">lastName</span> <span class="o">=</span> <span class="nx">lastName</span><span class="o">;</span><br/><span class="k">this</span><span class="p">.</span><span class="nx">address</span> <span class="o">=</span> <span class="nx">address</span><span class="o">;</span><br/><span class="k">this</span><span class="p">.</span><span class="nx">homePhone</span> <span class="o">=</span> <span class="nx">homePhone</span><span class="o">;</span><br/><span class="k">this</span><span class="p">.</span><span class="nx">workPhone</span> <span class="o">=</span> <span class="nx">workPhone</span><span class="o">;</span><br/><span class="k">this</span><span class="p">.</span><span class="nx">cellPhone</span> <span class="o">=</span> <span class="nx">cellPhone</span><span class="o">;</span><br/><span class="p">}</span><br/><br/><span class="c">// serializa a JSON</span><br/><span class="nx">AddressBook</span><span class="p">.</span><span class="nx">AddressBookEntry</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">serialize</span> <span class="o">=</span> <span class="k">function</span><span class="p">()</span><br/><span class="p">{</span><br/><span class="k">return</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><br/><span class="p">}</span><br/><br/><span class="nx">AddressBook</span><span class="p">.</span><span class="nx">AddressBook</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="nx">entries</span><span class="p">)</span><br/><span class="p">{</span><br/><span class="k">this</span><span class="p">.</span><span class="nx">entries</span> <span class="o">=</span> <span class="nx">entries</span> <span class="o">||</span> <span class="p">[];</span><br/><span class="p">}</span><br/><br/><span class="nx">AddressBook</span><span class="p">.</span><span class="nx">AddressBook</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">serialize</span> <span class="o">=</span> <span class="k">function</span><span class="p">()</span><br/><span class="p">{</span><br/><span class="k">return</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><br/><span class="p">}</span><br/><br/><span class="c">// devuelve una funcion que hace un request REST a path, usando method, el</span><br/><span class="c">// metodo devuelto recibe como primer parametro una entidad que es enviada</span><br/><span class="c">// en el *cuerpo* del request, por ello este metodo es util para PUT y POST</span><br/><span class="nx">AddressBook</span><span class="p">.</span><span class="nx">buildCreateUpdate</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="nx">method</span><span class="o">,</span> <span class="nx">path</span><span class="p">)</span><br/><span class="p">{</span><br/><span class="k">return</span> <span class="k">function</span><span class="p">(</span><span class="nx">entity</span><span class="o">,</span> <span class="nx">success_cb</span><span class="o">,</span> <span class="nx">error_cb</span><span class="p">)</span><br/><span class="p">{</span><br/><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span><span class="nx">url</span><span class="o">:</span> <span class="nx">path</span><span class="o">,</span> <span class="nx">type</span><span class="o">:</span> <span class="nx">method</span><span class="o">,</span> <span class="nx">dataType</span><span class="o">:</span> <span class="s2">"text"</span><span class="o">,</span> <span class="nx">contentType</span><span class="o">:</span> <span class="s2">"application/json"</span><span class="o">,</span><br/><span class="nx">data</span><span class="o">:</span> <span class="nx">entity</span><span class="p">.</span><span class="nx">serialize</span><span class="p">()</span><span class="o">,</span><br/><span class="nx">success</span><span class="o">:</span> <span class="nx">success_cb</span><span class="o">,</span> <span class="nx">error</span><span class="o">:</span> <span class="nx">error_cb</span><span class="p">});</span><br/><span class="p">}</span><br/><span class="p">}</span><br/><br/><span class="c">// devuelve una funcion que hace un request REST a path, usando method, el</span><br/><span class="c">// metodo devuelto recibe como primer un string que es agregado al path</span><br/><span class="c">// por ello este metodo es util para GET y DELETE</span><br/><span class="nx">AddressBook</span><span class="p">.</span><span class="nx">buildGetDelete</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="nx">method</span><span class="o">,</span> <span class="nx">path</span><span class="p">)</span><br/><span class="p">{</span><br/><span class="k">return</span> <span class="k">function</span><span class="p">(</span><span class="nx">id</span><span class="o">,</span> <span class="nx">success_cb</span><span class="o">,</span> <span class="nx">error_cb</span><span class="p">)</span><br/><span class="p">{</span><br/><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span><span class="nx">url</span><span class="o">:</span> <span class="nx">path</span> <span class="o">+</span> <span class="nx">id</span><span class="o">,</span> <span class="nx">type</span><span class="o">:</span> <span class="nx">method</span><span class="o">,</span> <span class="nx">dataType</span><span class="o">:</span> <span class="s2">"text"</span><span class="o">,</span><br/><span class="nx">success</span><span class="o">:</span> <span class="nx">success_cb</span><span class="o">,</span> <span class="nx">error</span><span class="o">:</span> <span class="nx">error_cb</span><span class="p">});</span><br/><span class="p">}</span><br/><span class="p">}</span><br/><br/><span class="nx">AddressBook</span><span class="p">.</span><span class="nx">getAll</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="nx">success_cb</span><span class="o">,</span> <span class="nx">error_cb</span><span class="p">)</span><br/><span class="p">{</span><br/><span class="k">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">AddressBook</span><span class="p">.</span><span class="nx">buildGetDelete</span><span class="p">(</span><span class="s2">"GET"</span><span class="o">,</span> <span class="s2">"/ws/book/json/all"</span><span class="p">);</span><br/><span class="nx">request</span><span class="p">(</span><span class="s2">""</span><span class="o">,</span> <span class="nx">success_cb</span><span class="o">,</span> <span class="nx">error_cb</span><span class="p">);</span><br/><span class="p">}</span><br/><br/><br/><span class="nx">AddressBook</span><span class="p">.</span><span class="nx">search</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="nx">type</span><span class="o">,</span> <span class="nx">query</span><span class="o">,</span> <span class="nx">success_cb</span><span class="o">,</span> <span class="nx">error_cb</span><span class="p">)</span><br/><span class="p">{</span><br/><span class="k">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">AddressBook</span><span class="p">.</span><span class="nx">buildGetDelete</span><span class="p">(</span><span class="s2">"GET"</span><span class="o">,</span> <span class="s2">"/ws/book/json/search"</span><span class="p">);</span><br/><span class="nx">request</span><span class="p">(</span><span class="s2">"/"</span> <span class="o">+</span> <span class="nx">type</span> <span class="o">+</span> <span class="s2">"/"</span> <span class="o">+</span> <span class="nx">query</span><span class="o">,</span> <span class="nx">success_cb</span><span class="o">,</span> <span class="nx">error_cb</span><span class="p">);</span><br/><span class="p">}</span><br/><br/><span class="nx">AddressBook</span><span class="p">.</span><span class="nx">create</span> <span class="o">=</span> <span class="nx">AddressBook</span><span class="p">.</span><span class="nx">buildCreateUpdate</span><span class="p">(</span><span class="s2">"PUT"</span><span class="o">,</span> <span class="s2">"/ws/book/"</span><span class="p">);</span><br/></pre></div><br/><br/>tambien hice algunos cambios en addressbook.ws.AddressBook, aca esta la version actual<br/><br/><div class="highlight"><pre><span class="c">/*</span><br/><span class="c"> * To change this template, choose Tools | Templates</span><br/><span class="c"> * and open the template in the editor.</span><br/><span class="c"> */</span><br/><br/><span class="k">package</span> <span class="n">addressbook</span><span class="o">.</span><span class="na">ws</span><span class="o">;</span><br/><br/><span class="k">import</span> <span class="nn">addressbook.model.AddressBookEntry</span><span class="o">;</span><br/><span class="k">import</span> <span class="nn">javax.ws.rs.Consumes</span><span class="o">;</span><br/><span class="k">import</span> <span class="nn">javax.ws.rs.GET</span><span class="o">;</span><br/><span class="k">import</span> <span class="nn">javax.ws.rs.PUT</span><span class="o">;</span><br/><span class="k">import</span> <span class="nn">javax.ws.rs.Path</span><span class="o">;</span><br/><span class="k">import</span> <span class="nn">javax.ws.rs.PathParam</span><span class="o">;</span><br/><span class="k">import</span> <span class="nn">javax.ws.rs.Produces</span><span class="o">;</span><br/><br/><span class="c">/**</span><br/><span class="c"> *</span><br/><span class="c"> * @author mariano</span><br/><span class="c"> */</span><br/><span class="nd">@Path</span><span class="o">(</span><span class="s">"book"</span><span class="o">)</span><br/><span class="k">public</span> <span class="k">class</span> <span class="nc">AddressBook</span> <span class="o">{</span><br/><span class="k">private</span> <span class="k">static</span> <span class="n">addressbook</span><span class="o">.</span><span class="na">model</span><span class="o">.</span><span class="na">AddressBook</span> <span class="n">addressBook</span><span class="o">;</span><br/><br/><span class="k">public</span> <span class="k">static</span> <span class="n">addressbook</span><span class="o">.</span><span class="na">model</span><span class="o">.</span><span class="na">AddressBook</span> <span class="nf">search</span><span class="o">(</span><span class="n">String</span> <span class="n">type</span><span class="o">,</span> <span class="n">String</span> <span class="n">query</span><span class="o">)</span><br/><span class="o">{</span><br/><span class="k">if</span><span class="o">(</span><span class="n">type</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"firstName"</span><span class="o">))</span><br/><span class="o">{</span><br/><span class="k">return</span> <span class="k">new</span> <span class="n">addressbook</span><span class="o">.</span><span class="na">model</span><span class="o">.</span><span class="na">AddressBook</span><span class="o">(</span><span class="n">addressBook</span><span class="o">.</span><span class="na">searchByFirstName</span><span class="o">(</span><span class="n">query</span><span class="o">));</span><br/><span class="o">}</span><br/><span class="k">else</span> <span class="nf">if</span><span class="o">(</span><span class="n">type</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"lastName"</span><span class="o">))</span><br/><span class="o">{</span><br/><span class="k">return</span> <span class="k">new</span> <span class="n">addressbook</span><span class="o">.</span><span class="na">model</span><span class="o">.</span><span class="na">AddressBook</span><span class="o">(</span><span class="n">addressBook</span><span class="o">.</span><span class="na">searchByLastName</span><span class="o">(</span><span class="n">query</span><span class="o">));</span><br/><span class="o">}</span><br/><span class="k">else</span><br/><span class="o">{</span><br/><span class="k">return</span> <span class="k">new</span> <span class="n">addressbook</span><span class="o">.</span><span class="na">model</span><span class="o">.</span><span class="na">AddressBook</span><span class="o">(</span><span class="n">addressBook</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">query</span><span class="o">));</span><br/><span class="o">}</span><br/><span class="o">}</span><br/><br/><span class="k">public</span> <span class="k">static</span> <span class="n">addressbook</span><span class="o">.</span><span class="na">model</span><span class="o">.</span><span class="na">AddressBook</span> <span class="nf">getAddressBook</span><span class="o">()</span><br/><span class="o">{</span><br/><span class="k">if</span><span class="o">(</span><span class="n">addressBook</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span><br/><span class="n">addressBook</span> <span class="o">=</span> <span class="k">new</span> <span class="n">addressbook</span><span class="o">.</span><span class="na">model</span><span class="o">.</span><span class="na">AddressBook</span><span class="o">();</span><br/><br/><span class="k">return</span> <span class="n">addressBook</span><span class="o">;</span><br/><span class="o">}</span><br/><br/><span class="k">public</span> <span class="k">static</span> <span class="kt">void</span> <span class="nf">fill</span><span class="o">()</span><br/><span class="o">{</span><br/><span class="n">getAddressBook</span><span class="o">();</span><br/><span class="n">addressBook</span><span class="o">.</span><span class="na">addEntry</span><span class="o">(</span><span class="k">new</span> <span class="n">AddressBookEntry</span><span class="o">(</span><span class="s">"Bob"</span><span class="o">,</span> <span class="s">"Esponja"</span><span class="o">,</span> <span class="s">"Fondo de Bikini 1"</span><span class="o">,</span> <span class="s">"123"</span><span class="o">,</span> <span class="s">"321"</span><span class="o">,</span> <span class="s">"5551"</span><span class="o">));</span><br/><span class="n">addressBook</span><span class="o">.</span><span class="na">addEntry</span><span class="o">(</span><span class="k">new</span> <span class="n">AddressBookEntry</span><span class="o">(</span><span class="s">"Gary"</span><span class="o">,</span> <span class="s">"Caracol"</span><span class="o">,</span> <span class="s">"Fondo de Bikini 2"</span><span class="o">,</span> <span class="s">"234"</span><span class="o">,</span> <span class="s">"432"</span><span class="o">,</span> <span class="s">"5552"</span><span class="o">));</span><br/><span class="n">addressBook</span><span class="o">.</span><span class="na">addEntry</span><span class="o">(</span><span class="k">new</span> <span class="n">AddressBookEntry</span><span class="o">(</span><span class="s">"Arenita"</span><span class="o">,</span> <span class="s">"Ardilla"</span><span class="o">,</span> <span class="s">"Fondo de Bikini 3"</span><span class="o">,</span> <span class="s">"345"</span><span class="o">,</span> <span class="s">"543"</span><span class="o">,</span> <span class="s">"5553"</span><span class="o">));</span><br/><span class="n">addressBook</span><span class="o">.</span><span class="na">addEntry</span><span class="o">(</span><span class="k">new</span> <span class="n">AddressBookEntry</span><span class="o">(</span><span class="s">"Patricio"</span><span class="o">,</span> <span class="s">"Estrella"</span><span class="o">,</span> <span class="s">"Fondo de Bikini 4"</span><span class="o">,</span> <span class="s">"456"</span><span class="o">,</span> <span class="s">"654"</span><span class="o">,</span> <span class="s">"5554"</span><span class="o">));</span><br/><span class="n">addressBook</span><span class="o">.</span><span class="na">addEntry</span><span class="o">(</span><span class="k">new</span> <span class="n">AddressBookEntry</span><span class="o">(</span><span class="s">"Calamardo"</span><span class="o">,</span> <span class="s">"Calamar"</span><span class="o">,</span> <span class="s">"Fondo de Bikini 5"</span><span class="o">,</span> <span class="s">"567"</span><span class="o">,</span> <span class="s">"765"</span><span class="o">,</span> <span class="s">"5555"</span><span class="o">));</span><br/><span class="o">}</span><br/><br/><span class="nd">@GET</span><br/><span class="nd">@Path</span><span class="o">(</span><span class="s">"xml/all"</span><span class="o">)</span><br/><span class="nd">@Produces</span><span class="o">(</span><span class="s">"application/xml"</span><span class="o">)</span><br/><span class="k">public</span> <span class="k">static</span> <span class="n">addressbook</span><span class="o">.</span><span class="na">model</span><span class="o">.</span><span class="na">AddressBook</span> <span class="nf">getAllXml</span><span class="o">()</span><br/><span class="o">{</span><br/><span class="k">return</span> <span class="n">addressBook</span><span class="o">;</span><br/><span class="o">}</span><br/><br/><span class="nd">@GET</span><br/><span class="nd">@Path</span><span class="o">(</span><span class="s">"json/all"</span><span class="o">)</span><br/><span class="nd">@Produces</span><span class="o">(</span><span class="s">"application/json"</span><span class="o">)</span><br/><span class="k">public</span> <span class="k">static</span> <span class="n">addressbook</span><span class="o">.</span><span class="na">model</span><span class="o">.</span><span class="na">AddressBook</span> <span class="nf">getAllJson</span><span class="o">()</span><br/><span class="o">{</span><br/><span class="k">return</span> <span class="n">addressBook</span><span class="o">;</span><br/><span class="o">}</span><br/><br/><span class="nd">@GET</span><br/><span class="nd">@Path</span><span class="o">(</span><span class="s">"xml/search/{type}/{query}"</span><span class="o">)</span><br/><span class="nd">@Produces</span><span class="o">(</span><span class="s">"application/xml"</span><span class="o">)</span><br/><span class="k">public</span> <span class="k">static</span> <span class="n">addressbook</span><span class="o">.</span><span class="na">model</span><span class="o">.</span><span class="na">AddressBook</span> <span class="nf">searchXml</span><span class="o">(</span><span class="nd">@PathParam</span><span class="o">(</span><span class="s">"type"</span><span class="o">)</span> <span class="n">String</span> <span class="n">type</span><span class="o">,</span> <span class="nd">@PathParam</span><span class="o">(</span><span class="s">"query"</span><span class="o">)</span> <span class="n">String</span> <span class="n">query</span><span class="o">)</span><br/><span class="o">{</span><br/><span class="k">return</span> <span class="nf">search</span><span class="o">(</span><span class="n">type</span><span class="o">,</span> <span class="n">query</span><span class="o">);</span><br/><span class="o">}</span><br/><br/><span class="nd">@GET</span><br/><span class="nd">@Path</span><span class="o">(</span><span class="s">"json/search/{type}/{query}"</span><span class="o">)</span><br/><span class="nd">@Produces</span><span class="o">(</span><span class="s">"application/json"</span><span class="o">)</span><br/><span class="k">public</span> <span class="k">static</span> <span class="n">addressbook</span><span class="o">.</span><span class="na">model</span><span class="o">.</span><span class="na">AddressBook</span> <span class="nf">searchJson</span><span class="o">(</span><span class="nd">@PathParam</span><span class="o">(</span><span class="s">"type"</span><span class="o">)</span> <span class="n">String</span> <span class="n">type</span><span class="o">,</span> <span class="nd">@PathParam</span><span class="o">(</span><span class="s">"query"</span><span class="o">)</span> <span class="n">String</span> <span class="n">query</span><span class="o">)</span><br/><span class="o">{</span><br/><span class="k">return</span> <span class="nf">search</span><span class="o">(</span><span class="n">type</span><span class="o">,</span> <span class="n">query</span><span class="o">);</span><br/><span class="o">}</span><br/><br/><span class="nd">@PUT</span><br/><span class="nd">@Consumes</span><span class="o">({</span><span class="s">"application/json"</span><span class="o">,</span> <span class="s">"application/xml"</span><span class="o">})</span><br/><span class="k">public</span> <span class="k">static</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">AddressBookEntry</span> <span class="n">entry</span><span class="o">)</span><br/><span class="o">{</span><br/><span class="n">addressBook</span><span class="o">.</span><span class="na">addEntry</span><span class="o">(</span><span class="n">entry</span><span class="o">);</span><br/><span class="o">}</span><br/><span class="o">}</span><br/></pre></div><br/>con este ejemplo tenemos una aplicación que expone una API REST y un cliente en javascript/html que lo consume y utiliza, expandiendo la cantidad de entidades en la API podemos escalar a una aplicacion completa.<br/><br/>Si ando con ganas en el proximo post voy a explicar como usar un ORM (object relational mapper) para almacenar el contenido de la entidad en una base de datos.<br/><br/>el codigo completo de este ejemplo lo voy a colgar en github en esta direccion http://github.com/marianoguerra/examples/tree/master, ahora a aprender a usar git :)
<div style="clear: both;"/>
