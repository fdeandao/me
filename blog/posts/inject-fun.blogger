
el post anterior lo escribi como calentamiento para este que es la realizacion de una idea que tuve hoy (y que se va a completar en el post siguiente).<br/><br/>ya hicimos un browser, ahora estaria bueno manosear el contenido de las paginas no?<br/><br/>la mejor forma que conozco en cualquier lenguaje de manipular html es jquery, asi que estaria bueno poder jugar con el en todas las paginas no? lastima que no todas lo incluyen...<br/><br/>pero si lo inyectamos si lo van a tener :)<br/><br/>entonces tenemos una pagina, un campo para poner codigo js y ejecutarlo y podemos modificar el contenido de la pagina, algo asi:<br/><br/><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://3.bp.blogspot.com/_XkKIWh0VZYk/SwcUHwxaikI/AAAAAAAAG1E/nMNjO8MbcfU/s1600/webless1.png"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 320px; height: 200px;" src="http://3.bp.blogspot.com/_XkKIWh0VZYk/SwcUHwxaikI/AAAAAAAAG1E/nMNjO8MbcfU/s320/webless1.png" border="0" alt="" id="BLOGGER_PHOTO_ID_5406312001265371714"/></a><br/><br/>por si no se ve corri el siguiente script: $('a').html('lol');<br/><br/>ahora vamos a ver un uso mas interesante:<br/><br/><object width="425" height="344"><param name="movie" value="http://www.youtube.com/v/ewfbudvJf18&amp;hl=en_US&amp;fs=1&amp;"/><param name="allowFullScreen" value="true"/><param name="allowscriptaccess" value="always"/><embed src="http://www.youtube.com/v/ewfbudvJf18&amp;hl=en_US&amp;fs=1&amp;" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" width="425" height="344"/></object><br/><br/>casi me olvido el codigo :)<br/><br/><div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span><br/><span class="kn">import</span> <span class="nn">sys</span><br/><span class="kn">import</span> <span class="nn">gtk</span><br/><span class="c"># https://bugs.launchpad.net/bugs/480398</span><br/><span class="n">gtk</span><span class="o">.</span><span class="n">gdk</span><span class="o">.</span><span class="n">threads_init</span><span class="p">()</span><br/><span class="kn">import</span> <span class="nn">webkit</span><br/><br/><span class="k">class</span> <span class="nc">Webless</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span><br/><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="s">''</span><span class="p">):</span><br/><span class="bp">self</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="n">webkit</span><span class="o">.</span><span class="n">WebView</span><span class="p">()</span><br/><span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><br/><br/><span class="k">def</span> <span class="nf">inject_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span><br/><span class="sd">'''run a script in a file'''</span><br/><span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span><br/><span class="bp">self</span><span class="o">.</span><span class="n">inject_script</span><span class="p">(</span><span class="nb">file</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><br/><span class="k">return</span> <span class="bp">True</span><br/><br/><span class="k">return</span> <span class="bp">False</span><br/><br/><span class="k">def</span> <span class="nf">inject_script</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">script</span><span class="p">):</span><br/><span class="sd">'''run a script'''</span><br/><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="n">script</span><span class="p">)</span><br/><br/><span class="k">def</span> <span class="nf">get_code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span><br/><span class="sd">'''return the text of the widget'''</span><br/><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s">'oldtitle=document.title;document.title=document.documentElement.innerHTML;'</span><span class="p">)</span><br/><span class="n">html</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">get_main_frame</span><span class="p">()</span><span class="o">.</span><span class="n">get_title</span><span class="p">()</span><br/><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s">'document.title=oldtitle;'</span><span class="p">)</span><br/><span class="k">return</span> <span class="n">html</span><br/><br/><span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span><br/><span class="k">if</span> <span class="ow">not</span> <span class="n">url</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">'http://'</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">url</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">'https://'</span><span class="p">):</span><br/><span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="s">'http://'</span> <span class="o">+</span> <span class="n">url</span><br/><span class="k">else</span><span class="p">:</span><br/><span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span><br/><br/><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span><br/><br/><span class="k">class</span> <span class="nc">Browserless</span><span class="p">(</span><span class="n">gtk</span><span class="o">.</span><span class="n">Window</span><span class="p">,</span> <span class="n">Webless</span><span class="p">):</span><br/><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="s">''</span><span class="p">):</span><br/><span class="n">gtk</span><span class="o">.</span><span class="n">Window</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><br/><span class="n">Webless</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span><br/><span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">)</span><br/><br/><span class="k">class</span> <span class="nc">Browser</span><span class="p">(</span><span class="n">gtk</span><span class="o">.</span><span class="n">Window</span><span class="p">,</span> <span class="n">Webless</span><span class="p">):</span><br/><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="s">''</span><span class="p">):</span><br/><span class="n">gtk</span><span class="o">.</span><span class="n">Window</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><br/><span class="n">Webless</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span><br/><span class="bp">self</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Browser'</span><span class="p">)</span><br/><span class="bp">self</span><span class="o">.</span><span class="n">set_default_size</span><span class="p">(</span><span class="mf">640</span><span class="p">,</span> <span class="mf">480</span><span class="p">)</span><br/><br/><span class="n">scroll</span> <span class="o">=</span> <span class="n">gtk</span><span class="o">.</span><span class="n">ScrolledWindow</span><span class="p">()</span><br/><span class="n">scroll</span><span class="o">.</span><span class="n">set_policy</span><span class="p">(</span><span class="n">gtk</span><span class="o">.</span><span class="n">POLICY_AUTOMATIC</span><span class="p">,</span> <span class="n">gtk</span><span class="o">.</span><span class="n">POLICY_AUTOMATIC</span><span class="p">)</span><br/><span class="n">scroll</span><span class="o">.</span><span class="n">set_shadow_type</span><span class="p">(</span><span class="n">gtk</span><span class="o">.</span><span class="n">SHADOW_IN</span><span class="p">)</span><br/><br/><span class="n">scroll</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">)</span><br/><br/><span class="n">vbox</span> <span class="o">=</span> <span class="n">gtk</span><span class="o">.</span><span class="n">VBox</span><span class="p">()</span><br/><span class="n">hbox</span> <span class="o">=</span> <span class="n">gtk</span><span class="o">.</span><span class="n">HBox</span><span class="p">()</span><br/><br/><span class="n">entry</span> <span class="o">=</span> <span class="n">gtk</span><span class="o">.</span><span class="n">Entry</span><span class="p">()</span><br/><span class="n">entry</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">'activate'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_url_changed</span><span class="p">)</span><br/><br/><span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">:</span><br/><span class="n">entry</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span><br/><br/><span class="n">code</span> <span class="o">=</span> <span class="n">gtk</span><span class="o">.</span><span class="n">Entry</span><span class="p">()</span><br/><span class="n">code</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">'activate'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_run_code</span><span class="p">)</span><br/><br/><span class="n">getcode</span> <span class="o">=</span> <span class="n">gtk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s">"html to clipboard"</span><span class="p">)</span><br/><span class="n">getcode</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">'clicked'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_get_code</span><span class="p">)</span><br/><br/><span class="n">hbox</span><span class="o">.</span><span class="n">pack_start</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span><br/><span class="n">hbox</span><span class="o">.</span><span class="n">pack_start</span><span class="p">(</span><span class="n">getcode</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span><br/><br/><span class="n">vbox</span><span class="o">.</span><span class="n">pack_start</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span><br/><span class="n">vbox</span><span class="o">.</span><span class="n">pack_start</span><span class="p">(</span><span class="n">scroll</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span><br/><span class="n">vbox</span><span class="o">.</span><span class="n">pack_start</span><span class="p">(</span><span class="n">hbox</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span><br/><span class="n">vbox</span><span class="o">.</span><span class="n">show_all</span><span class="p">()</span><br/><br/><span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vbox</span><span class="p">)</span><br/><br/><span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">'delete-event'</span><span class="p">,</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mf">0</span><span class="p">))</span><br/><br/><span class="k">def</span> <span class="nf">_on_get_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">button</span><span class="p">):</span><br/><span class="sd">'''copy the content of the html window to the clipboard'''</span><br/><span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_code</span><span class="p">()</span><br/><span class="n">gtk</span><span class="o">.</span><span class="n">clipboard_get</span><span class="p">()</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="n">code</span><span class="p">)</span><br/><br/><span class="k">def</span> <span class="nf">_on_url_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span><br/><span class="sd">'''called when the url changes'''</span><br/><span class="n">url</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span><br/><span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><br/><br/><span class="k">def</span> <span class="nf">_on_run_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span><br/><span class="sd">'''called when the url changes'''</span><br/><span class="n">code</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span><br/><span class="bp">self</span><span class="o">.</span><span class="n">inject_script</span><span class="p">(</span><span class="n">code</span><span class="p">)</span><br/><br/><span class="k">def</span> <span class="nf">process_events</span><span class="p">():</span><br/><span class="k">while</span> <span class="n">gtk</span><span class="o">.</span><span class="n">events_pending</span><span class="p">():</span><br/><span class="n">gtk</span><span class="o">.</span><span class="n">main_iteration</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span><br/><br/><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span><br/><span class="n">browser</span> <span class="o">=</span> <span class="n">Browser</span><span class="p">(</span><span class="s">'www.google.com/search?q=emesene'</span><span class="p">)</span><br/><br/><span class="k">def</span> <span class="nf">inject_fun</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span><br/><span class="n">browser</span><span class="o">.</span><span class="n">inject_file</span><span class="p">(</span><span class="s">'js/jquery.js'</span><span class="p">)</span><br/><span class="n">browser</span><span class="o">.</span><span class="n">inject_file</span><span class="p">(</span><span class="s">'js/json2.js'</span><span class="p">)</span><br/><br/><span class="n">browser</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">'load-finished'</span><span class="p">,</span> <span class="n">inject_fun</span><span class="p">)</span><br/><br/><span class="n">browser</span><span class="o">.</span><span class="n">show</span><span class="p">()</span><br/><br/><span class="n">gtk</span><span class="o">.</span><span class="n">main</span><span class="p">()</span><br/></pre></div>
<div style="clear: both;"/>
