
Note: the project and this document are hosted here: <a href="https://github.com/marianoguerra/pshb-example">https://github.com/marianoguerra/pshb-example </a>improvements and corrections are welcome!<br/><br/>
welcome, this document contains an example application written in python that will help you play with a pshb (pubsubhubbub from now on) hub and an application that publishes its content to it.<br/><br/>
this guide explains how to install a pubsubhubbub server in your computer so you can play with it, normally on a web application you would use a pshb compatible server like:<br/><ul><li>official pshb hub on app engine: <a href="http://pubsubhubbub.appspot.com/">http://pubsubhubbub.appspot.com/</a></li>
<li>superfeedr hub: <a href="http://superfeedr.com/">http://superfeedr.com/</a></li>
</ul><div class="section" id="requirements"><h1> </h1><h1>Requirements</h1><h1> </h1><blockquote><ul class="simple"><li>python &gt;= 2.5 (I'm using 2.6.1)</li>
<li>git (for the example)</li>
<li>subversion (to download pshb code)</li>
<li>bash or similar shell to run the scripts</li>
</ul></blockquote></div><div class="section" id="installing"><h1> </h1><h1>Installing</h1><h1> </h1><pre class="literal-block">git clone https://github.com/marianoguerra/pshb-example.git
cd pshb-example
bash setup.sh</pre><pre class="literal-block"/>the first command will fetch the project from github, the third one will get some libraries needed for the example to run.<br/><br/>
note: answer "y" to sammy and "n" to all the other questions that the script does (we don't need those libraries)</div><div class="section" id="running"><h1> </h1><h1>Running</h1><h1> </h1>now we will start the example application called pleinu twice (so we can test the communication using the hub) and we will start a local pshb hub.<br/><br/>
open 3 terminals and run one comment on each one:<br/><br/><pre class="literal-block">google_appengine/dev_appserver.py src/ -p 8000 --datastore_path=/tmp/tubes1
google_appengine/dev_appserver.py src/ -p 8001 --datastore_path=/tmp/tubes2
google_appengine/dev_appserver.py pubsubhubbub/hub/</pre><pre class="literal-block"/>this commands asume that you are at the root of the pshb-example folder.</div><div class="section" id="playing"><h1> </h1><h1>Playing</h1><h1> </h1>open a browser tabs pointing to:<br/><blockquote><ul class="simple"><li><a class="reference external" href="http://localhost:8000/">http://localhost:8000/</a></li>
</ul></blockquote>click the signup link and create a new user.<br/><br/><div class="separator" style="clear: both; text-align: center;"><a href="https://github.com/marianoguerra/pshb-example/raw/master/doc/img/pshb-1.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="121" src="https://github.com/marianoguerra/pshb-example/raw/master/doc/img/pshb-1.png" width="320"/></a></div><br/><br/>
I will create one called spongebob, you will have to change the username whenever you see it.<br/><br/><div class="separator" style="clear: both; text-align: center;"><a href="https://github.com/marianoguerra/pshb-example/raw/master/doc/img/pshb-2.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="119" src="https://github.com/marianoguerra/pshb-example/raw/master/doc/img/pshb-2.png" width="320"/></a></div><br/><br/>
after the signup process click the login button and enter the user and password you just entered.<br/><br/><div class="separator" style="clear: both; text-align: center;"><a href="https://github.com/marianoguerra/pshb-example/raw/master/doc/img/pshb-3.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="62" src="https://github.com/marianoguerra/pshb-example/raw/master/doc/img/pshb-3.png" width="320"/></a></div><br/><br/>
create a message and click send, the message should appear below.<br/><br/><div class="separator" style="clear: both; text-align: center;"/><div class="separator" style="clear: both; text-align: center;"><a href="https://github.com/marianoguerra/pshb-example/raw/master/doc/img/pshb-4.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="90" src="https://github.com/marianoguerra/pshb-example/raw/master/doc/img/pshb-4.png" width="320"/></a></div><br/><br/><div class="separator" style="clear: both; text-align: center;"><a href="https://github.com/marianoguerra/pshb-example/raw/master/doc/img/pshb-5.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="116" src="https://github.com/marianoguerra/pshb-example/raw/master/doc/img/pshb-5.png" width="320"/></a></div><br/><br/>
now go to <a class="reference external" href="http://localhost:8000/atom/messages/from/spongebob/">http://localhost:8000/atom/messages/from/spongebob/</a><br/><br/><div class="separator" style="clear: both; text-align: center;"><a href="https://github.com/marianoguerra/pshb-example/raw/master/doc/img/pshb-6.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="233" src="https://github.com/marianoguerra/pshb-example/raw/master/doc/img/pshb-6.png" width="320"/></a></div><br/><br/>
you should see an atom feed with the message you just created.</div><div class="section" id="publishing"><h1> </h1><h1>Publishing</h1><h1> </h1>now that we have a page that generates information we need to publish it on the hub.<br/><br/>
open a tab in your browser pointing to <a class="reference external" href="http://localhost:8080/">http://localhost:8080/</a> and click on the publish link near the bottom.<br/><br/><div class="separator" style="clear: both; text-align: center;"><a href="https://github.com/marianoguerra/pshb-example/raw/master/doc/img/pshb-7.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="320" src="https://github.com/marianoguerra/pshb-example/raw/master/doc/img/pshb-7.png" width="317"/></a></div></div><div class="section" id="publishing"><div class="separator" style="clear: both; text-align: center;"><a href="https://github.com/marianoguerra/pshb-example/raw/master/doc/img/pshb-8.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="320" src="https://github.com/marianoguerra/pshb-example/raw/master/doc/img/pshb-8.png" width="300"/></a></div><br/><br/>
if you get an error remove the s from the https protocol in the address bar and refresh.<br/><br/><div class="separator" style="clear: both; text-align: center;"><a href="https://github.com/marianoguerra/pshb-example/raw/master/doc/img/pshb-9.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="88" src="https://github.com/marianoguerra/pshb-example/raw/master/doc/img/pshb-9.png" width="320"/></a></div><br/><br/>
on the Topic field enter the url to the atom feed we saw before: <a class="reference external" href="http://localhost:8000/atom/messages/from/spongebob/">http://localhost:8000/atom/messages/from/spongebob/</a><br/><br/><div class="separator" style="clear: both; text-align: center;"><a href="https://github.com/marianoguerra/pshb-example/raw/master/doc/img/pshb-10.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="146" src="https://github.com/marianoguerra/pshb-example/raw/master/doc/img/pshb-10.png" width="320"/></a></div><br/><br/>
and click Publish, the page wont change, that's ok.</div><div class="section" id="subscribing"><h1> </h1><h1>Subscribing</h1><h1> </h1>now we need to subscribe one user from the other site (<a class="reference external" href="http://localhost:8001/">http://localhost:8001/</a>) to the messages sent by our user.<br/><br/>
go to <a class="reference external" href="http://localhost:8001/">http://localhost:8001/</a> and create another user, I will call it patrick<br/><br/><div class="separator" style="clear: both; text-align: center;"><a href="https://github.com/marianoguerra/pshb-example/raw/master/doc/img/pshb-11.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="121" src="https://github.com/marianoguerra/pshb-example/raw/master/doc/img/pshb-11.png" width="320"/></a></div><br/><br/>
in the main page of the hub (<a class="reference external" href="http://localhost:8080/">http://localhost:8080/</a>) click on the subscribe like near the bottom<br/><br/>
enter <a class="reference external" href="http://localhost:8001/p/notify/patrick/">http://localhost:8001/p/notify/patrick/</a> on the Callback field (change patrick for your username if you used another one) enter <a class="reference external" href="http://localhost:8000/atom/messages/from/spongebob/">http://localhost:8000/atom/messages/from/spongebob/</a> on the Topic field (change spongebob for your username if you used another one)<br/><br/><div class="separator" style="clear: both; text-align: center;"><a href="https://github.com/marianoguerra/pshb-example/raw/master/doc/img/pshb-12.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="320" src="https://github.com/marianoguerra/pshb-example/raw/master/doc/img/pshb-12.png" width="308"/></a></div><br/><br/>
click the "Do it" button, the page won't change, that's ok.</div><div class="section" id="sending-a-message"><h1> </h1><h1>Sending a message</h1><h1> </h1>Go to <a class="reference external" href="http://localhost:8000/">http://localhost:8000/</a> (login if you closed it) and send a message.<br/><br/><div class="separator" style="clear: both; text-align: center;"><a href="https://github.com/marianoguerra/pshb-example/raw/master/doc/img/pshb-13.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="213" src="https://github.com/marianoguerra/pshb-example/raw/master/doc/img/pshb-13.png" width="320"/></a></div><br/><br/>
 Now go to <a class="reference external" href="http://localhost:8001/">http://localhost:8001/</a> and refresh the page, you should see the messages published by the user in the other site.<br/><br/><div class="separator" style="clear: both; text-align: center;"><a href="https://github.com/marianoguerra/pshb-example/raw/master/doc/img/pshb-16.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="214" src="https://github.com/marianoguerra/pshb-example/raw/master/doc/img/pshb-16.png" width="320"/></a></div><br/><br/><div class="note"><div class="first admonition-title"><b>Note</b></div><div class="first admonition-title"><br/></div><i> </i><br/><div class="last"><i>to make it work and avoid an exception I had to add a  return statement at the beginning of the log_message function at  google_appengine/google/appengine/tools/dev_appserver.py</i></div></div><br/>
if you get that exception like this:<br/><br/><pre class="literal-block">in log_request
    self.requestline, str(code), str(size))
  File "/home/asd/pubsubhubbub/pshb/google_appengine/google/appengine/
tools/dev_appserver.py", line 3314, in log_message
    if self.channel_poll_path_re.match(self.path):
AttributeError: DevAppServerRequestHandler instance has no attribute
'path'</pre><pre class="literal-block"/>edit the function to look like this:<br/><pre class="literal-block"> </pre><pre class="literal-block">def log_message(self, format, *args):
  """Redirect log messages through the logging module."""
  return
  if self.channel_poll_path_re.match(self.path):
    logging.debug(format, *args)
  else:
    logging.info(format, *args)
</pre><br/><div class="separator" style="clear: both; text-align: center;"><a href="https://github.com/marianoguerra/pshb-example/raw/master/doc/img/pshb-15.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="142" src="https://github.com/marianoguerra/pshb-example/raw/master/doc/img/pshb-15.png" width="320"/></a></div><br/><br/>
you will have to set write permissions to the file to save it (chmod u+w dev_appserver.py)<br/><br/><div class="separator" style="clear: both; text-align: center;"><a href="https://github.com/marianoguerra/pshb-example/raw/master/doc/img/pshb-14.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="137" src="https://github.com/marianoguerra/pshb-example/raw/master/doc/img/pshb-14.png" width="320"/></a></div><br/><br/>
you will have to restart the pshb server:<br/><br/><br/><pre class="literal-block">google_appengine/dev_appserver.py pubsubhubbub/hub/</pre></div>
<div style="clear: both;"/>
