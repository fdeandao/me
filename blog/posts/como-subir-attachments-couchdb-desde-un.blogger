
algo que costo poner a andar fue subir attachments a un documento desde una pagina web, termine leyendo como lo hace <a href="http://svn.apache.org/viewvc/couchdb/trunk/share/www/script/futon.browse.js?view=markup">futon</a> (linea 886, el frontend de couchdb) y quedo algo asi:<br/><br/>en el html<br/><br/><div class="highlight"><pre>   <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"upload"</span><span class="nt">&gt;</span><br/><span class="nt">&lt;form</span> <span class="na">id=</span><span class="s">"upload-form"</span> <span class="na">method=</span><span class="s">"POST"</span> <span class="na">action=</span><span class="s">""</span> <span class="na">enctype=</span><span class="s">"multipart/form-data"</span><span class="nt">&gt;</span><br/><span class="nt">&lt;p</span> <span class="na">id=</span><span class="s">"upload-msg"</span><span class="nt">&gt;&lt;/p&gt;</span><br/><span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"_attachments"</span><span class="nt">&gt;</span>Archivo<span class="nt">&lt;/label&gt;</span><br/><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"_attachments"</span> <span class="na">id=</span><span class="s">"image-file"</span><span class="nt">/&gt;</span><br/><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"buttons"</span><span class="nt">&gt;</span><br/><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">value=</span><span class="s">""</span> <span class="na">name=</span><span class="s">"_rev"</span><span class="nt">/&gt;</span><br/><span class="nt">&lt;button</span> <span class="na">onclick=</span><span class="s">"return ui.upload();"</span><span class="nt">&gt;</span>Adjuntar<span class="nt">&lt;/button&gt;</span><br/><span class="nt">&lt;/div&gt;</span><br/><span class="nt">&lt;/form&gt;</span><br/><span class="nt">&lt;/div&gt;</span><br/><span class="nt">&lt;/div&gt;</span><br/></pre></div><br/><br/>en el codigo javascript:<br/><br/><div class="highlight"><pre><span class="c">// en algun lado del init correr esto</span><br/><span class="nx">$</span><span class="p">(</span><span class="s1">'#upload-form'</span><span class="p">).</span><span class="nx">ajaxForm</span><span class="p">();</span><br/><br/><span class="nx">ui</span><span class="p">.</span><span class="nx">upload</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span><br/><span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"input[name='_id']"</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">,</span> <span class="nx">form</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'#upload-form'</span><span class="p">)</span><span class="o">,</span> <span class="nx">field</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'#image-file'</span><span class="p">);</span><br/><br/><span class="k">if</span> <span class="p">(</span><span class="nx">field</span><span class="p">.</span><span class="nx">val</span><span class="p">().</span><span class="nx">trim</span><span class="p">()</span> <span class="o">===</span> <span class="s1">''</span><span class="p">)</span> <span class="p">{</span><br/><span class="nx">ui</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">"Archivo no seleccionado"</span><span class="p">);</span><br/><span class="k">return</span> <span class="kc">false</span><span class="o">;</span><br/><span class="p">}</span><br/><span class="k">else</span> <span class="p">{</span><br/><span class="nx">form</span><span class="p">.</span><span class="nx">ajaxSubmit</span><span class="p">({</span><br/><span class="nx">url</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">base</span> <span class="o">+</span> <span class="nx">id</span><span class="o">,</span><br/><span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">resp</span><span class="p">)</span> <span class="p">{</span><br/><span class="nx">field</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="s1">''</span><span class="p">);</span><br/><span class="nx">ui</span><span class="p">.</span><span class="nx">message</span><span class="p">(</span><span class="s1">'Imagen adjuntada'</span><span class="p">);</span><br/><span class="p">}});</span><br/><span class="p">}</span><br/><span class="p">};</span><br/></pre></div><br/><br/>para hacerlo hace falta jquery y el plugin ajaxsubmit<br/><br/>PD: este es el post 300, 300 posts intrascendentes de una persona intrascendente, keep poluting the interwebs<br/><br/>PD1: vino ian curtis con una pepsi de litro y medio para festejar (la de dos litros esta cara)<br/><br/>PD2: no, no voy a poner una imagen de la pelicula 300 :P<br/><br/><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://i6.photobucket.com/albums/y213/naxxty/iancurtis.gif"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 314px; height: 495px;" src="http://i6.photobucket.com/albums/y213/naxxty/iancurtis.gif" border="0" alt=""/></a>
<div style="clear: both;"/>
